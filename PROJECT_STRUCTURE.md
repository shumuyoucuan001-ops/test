# æœ¯æœ¨ä¼˜é€‰ - é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ é¡¹ç›®æ¦‚è¿°
æœ¯æœ¨ä¼˜é€‰æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ ‡ç­¾æ‰“å°ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«Webç«¯ç®¡ç†ç•Œé¢ã€åç«¯APIæœåŠ¡å’Œç§»åŠ¨ç«¯åº”ç”¨ã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

### ğŸŒ Webç«¯ (å‰ç«¯)
```
web/                          # Next.js å‰ç«¯åº”ç”¨
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                  # Next.js App Router é¡µé¢
â”‚   â”‚   â”œâ”€â”€ home/            # ä¸»è¦åŠŸèƒ½é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ admin-permissions/  # æƒé™ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ admin-roles/        # è§’è‰²ç®¡ç†  
â”‚   â”‚   â”‚   â”œâ”€â”€ admin-users/        # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ print/              # å•†å“æœç´¢æ‰“å°
â”‚   â”‚   â”‚   â”œâ”€â”€ product-supplement/ # æ ‡ç­¾èµ„æ–™ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ products/           # å•†å“èµ„æ–™
â”‚   â”‚   â”‚   â”œâ”€â”€ purchase/           # æ”¶è´§å•æŸ¥è¯¢æ‰“å°
â”‚   â”‚   â”‚   â”œâ”€â”€ supplier-management/ # ä¾›åº”å•†ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ templates/          # æ ‡ç­¾æ¨¡æ¿
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx          # ä¸»å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ login/           # ç™»å½•é¡µé¢
â”‚   â”‚   â””â”€â”€ api/             # API ä»£ç†è·¯ç”±
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ Hooks
â”‚   â””â”€â”€ lib/                # å·¥å…·åº“å’ŒAPIé…ç½®
â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”œâ”€â”€ package.json           # ä¾èµ–é…ç½®
â””â”€â”€ next.config.ts         # Next.js é…ç½®
```

**ä¸»è¦åŠŸèƒ½**ï¼š
- ç”¨æˆ·ç™»å½•è®¤è¯
- æƒé™ç®¡ç†ç³»ç»Ÿï¼ˆç”¨æˆ·ã€è§’è‰²ã€æƒé™ï¼‰
- å•†å“èµ„æ–™ç®¡ç†
- æ ‡ç­¾æ¨¡æ¿ç®¡ç†ï¼ˆæ”¯æŒHTMLå’ŒTSPLåŒæ¨¡æ¿ï¼‰
- æ”¶è´§å•æŸ¥è¯¢å’Œæ ‡ç­¾æ‰“å°
- ä¾›åº”å•†ç®¡ç†

### ğŸ”§ åç«¯API
```
server/                       # NestJS åç«¯æœåŠ¡
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ acl/                 # æƒé™æ§åˆ¶æ¨¡å—
â”‚   â”œâ”€â”€ template/            # æ ‡ç­¾æ¨¡æ¿æ¨¡å—
â”‚   â”œâ”€â”€ product/             # å•†å“ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ receipt/             # æ”¶è´§å•æ¨¡å—
â”‚   â”œâ”€â”€ label-data/          # æ ‡ç­¾æ•°æ®æ¨¡å—
â”‚   â”œâ”€â”€ label-print/         # æ ‡ç­¾æ‰“å°æ¨¡å—
â”‚   â”œâ”€â”€ supplier/            # ä¾›åº”å•†æ¨¡å—
â”‚   â”œâ”€â”€ prisma/              # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ main.ts              # åº”ç”¨å…¥å£
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma        # æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ package.json            # ä¾èµ–é…ç½®
â””â”€â”€ nest-cli.json           # NestJS é…ç½®
```

**ä¸»è¦åŠŸèƒ½**ï¼š
- RESTful API æœåŠ¡
- ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
- æ•°æ®åº“æ“ä½œï¼ˆPrisma ORMï¼‰
- æ ‡ç­¾æ¨¡æ¿æ¸²æŸ“ï¼ˆHTMLè½¬TSPLï¼‰
- æ‰¹é‡æ ‡ç­¾æ‰“å°ä¼˜åŒ–

### ğŸ“± ç§»åŠ¨ç«¯åº”ç”¨

#### React Native åº”ç”¨
```
SmLabelApp/                 # React Native åº”ç”¨ (å®Œæ•´åŠŸèƒ½)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api.ts             # APIé…ç½®
â”‚   â””â”€â”€ screens/           # é¡µé¢ç»„ä»¶
â”‚       â”œâ”€â”€ LoginScreen.tsx # ç™»å½•é¡µé¢
â”‚       â””â”€â”€ HomeScreen.tsx  # ä¸»é¡µ
â”œâ”€â”€ App.tsx                # åº”ç”¨å…¥å£ (å¯¼èˆªé…ç½®)
â”œâ”€â”€ android/               # Android é…ç½®
â”œâ”€â”€ ios/                   # iOS é…ç½®
â”œâ”€â”€ package.json          # ä¾èµ–é…ç½® (åŒ…å«è“ç‰™æ‰“å°ç­‰)
â””â”€â”€ app.json              # åº”ç”¨é…ç½®
```

#### Expo åº”ç”¨ (æ¨è)
```
SmLabelAppExpo/            # Expo åº”ç”¨ (åŠŸèƒ½æœ€å®Œæ•´)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api.ts            # APIé…ç½®
â”‚   â”œâ”€â”€ screens/          # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ LoginScreen.tsx        # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ HomeScreen.tsx         # ä¸»é¡µ
â”‚   â”‚   â”œâ”€â”€ ReceiptPrintScreen.tsx # æ”¶è´§å•æ‰“å°
â”‚   â”‚   â”œâ”€â”€ ProductLabelScreen.tsx # å•†å“æ ‡ç­¾
â”‚   â”‚   â””â”€â”€ PrinterSettingsScreen.tsx # æ‰“å°æœºè®¾ç½®
â”‚   â””â”€â”€ services/         # æœåŠ¡æ¨¡å—
â”‚       â”œâ”€â”€ PrintService.ts       # æ‰“å°æœåŠ¡
â”‚       â”œâ”€â”€ BluetoothPrinter.ts   # è“ç‰™æ‰“å°æœº
â”‚       â”œâ”€â”€ TsplBuilder.ts        # TSPLæŒ‡ä»¤æ„å»º
â”‚       â””â”€â”€ TemplateHtmlToTspl.ts # æ¨¡æ¿è½¬æ¢
â”œâ”€â”€ App.tsx               # åº”ç”¨å…¥å£
â”œâ”€â”€ assets/               # é™æ€èµ„æº
â”œâ”€â”€ package.json         # ä¾èµ–é…ç½®
â””â”€â”€ app.json            # Expo é…ç½®
```

**ä¸»è¦åŠŸèƒ½**ï¼š
- è¿æ¥åç«¯APIæµ‹è¯•
- æ”¶è´§å•åˆ—è¡¨è·å–
- æ‰¹é‡TSPLæ ‡ç­¾ç”Ÿæˆ
- æ ‡ç­¾æ‰“å°åŠŸèƒ½æµ‹è¯•

### ğŸš€ éƒ¨ç½²é…ç½®
```
deploy/                     # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ README_FIRST_DEPLOY_IP.md
â””â”€â”€ start.sh

scripts/                    # å·¥å…·è„šæœ¬
â”œâ”€â”€ first_deploy_ip.sh
â””â”€â”€ update_ip.sh

docker-compose.yml          # Docker ç¼–æ’é…ç½®
Dockerfile                  # Web å®¹å™¨é…ç½®
Dockerfile.api             # API å®¹å™¨é…ç½®
```

## ğŸ”§ æŠ€æœ¯æ ˆ

### å‰ç«¯ (Web)
- **æ¡†æ¶**: Next.js 15.5.0 (App Router)
- **UIåº“**: Ant Design 5.27.1
- **çŠ¶æ€ç®¡ç†**: React Hooks
- **HTTPå®¢æˆ·ç«¯**: Axios
- **æ ·å¼**: CSS Modules + Ant Design
- **ç±»å‹æ£€æŸ¥**: TypeScript

### åç«¯ (API)
- **æ¡†æ¶**: NestJS
- **æ•°æ®åº“**: MySQL (é€šè¿‡Prisma ORM)
- **è®¤è¯**: è‡ªå®šä¹‰JWTè®¤è¯
- **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC)
- **æ¨¡æ¿å¼•æ“**: è‡ªå®šä¹‰HTMLè½¬TSPLè½¬æ¢å™¨

### ç§»åŠ¨ç«¯
- **React Native**: åŸç”Ÿåº”ç”¨å¼€å‘
- **Expo**: å¿«é€Ÿå¼€å‘å’Œæµ‹è¯•
- **ç½‘ç»œè¯·æ±‚**: Fetch API

### æ•°æ®åº“
- **ä¸»æ•°æ®åº“**: MySQL
- **ORM**: Prisma
- **ä¸»è¦è¡¨**:
  - `sys_users` - ç”¨æˆ·è¡¨
  - `sys_roles` - è§’è‰²è¡¨  
  - `sys_permissions` - æƒé™è¡¨
  - `label_templates` - æ ‡ç­¾æ¨¡æ¿è¡¨
  - `product_master` - å•†å“ä¸»æ¡£è¡¨
  - `label_data` - æ ‡ç­¾èµ„æ–™è¡¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
# åç«¯
cd server && npm install

# å‰ç«¯
cd web && npm install

# React Native (å¯é€‰)
cd SmLabelApp && npm install

# Expo (æ¨è)  
cd SmLabelAppExpo && npm install
```

### 2. é…ç½®æ•°æ®åº“
```bash
cd server
# é…ç½® prisma/schema.prisma ä¸­çš„æ•°æ®åº“è¿æ¥
npx prisma generate
npx prisma db push
```

### 3. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨åç«¯ (ç«¯å£ 4000)
cd server && npm start

# å¯åŠ¨å‰ç«¯ (ç«¯å£ 3000)
cd web && npm run dev
```

### 4. è®¿é—®åº”ç”¨
- Webç«¯: http://localhost:3000
- APIæ–‡æ¡£: http://localhost:4000
- ç™»å½•è´¦å·: admin18984581968 (å…·æœ‰å…¨éƒ¨æƒé™)

## ğŸ“ å¼€å‘è¯´æ˜

### æƒé™ç³»ç»Ÿ
- åŸºäºRBACæ¨¡å‹ï¼Œæ”¯æŒç”¨æˆ·-è§’è‰²-æƒé™ä¸‰çº§ç®¡ç†
- å‰ç«¯ä½¿ç”¨`usePermissions` Hookå’Œ`PermissionGuard`ç»„ä»¶æ§åˆ¶è®¿é—®
- åç«¯é€šè¿‡è£…é¥°å™¨å’Œä¸­é—´ä»¶è¿›è¡Œæƒé™éªŒè¯

### æ ‡ç­¾æ‰“å°
- æ”¯æŒHTMLå’ŒTSPLåŒæ¨¡æ¿æ ¼å¼
- HTMLæ¨¡æ¿ç”¨äºé¢„è§ˆï¼ŒTSPLæ¨¡æ¿ç”¨äºå®é™…æ‰“å°
- å®ç°äº†æ‰¹é‡æ‰“å°ä¼˜åŒ–ï¼Œå‡å°‘æ‰“å°æœºé€šä¿¡æ¬¡æ•°

### APIä»£ç†
- å‰ç«¯é€šè¿‡Next.js rewritesåŠŸèƒ½ä»£ç†APIè¯·æ±‚
- å¼€å‘ç¯å¢ƒï¼šå‰ç«¯3000ç«¯å£ï¼Œåç«¯4000ç«¯å£
- ç”Ÿäº§ç¯å¢ƒï¼šé€šè¿‡Dockerç»Ÿä¸€éƒ¨ç½²

## ğŸ”„ ç‰ˆæœ¬å†å²
- v1.0: åŸºç¡€åŠŸèƒ½å®ç°
- v1.1: æƒé™ç³»ç»Ÿå®Œå–„
- v1.2: åŒæ¨¡æ¿æ”¯æŒ
- v1.3: æ‰¹é‡æ‰“å°ä¼˜åŒ–
- v1.4: ç§»åŠ¨ç«¯åº”ç”¨æ”¯æŒ
