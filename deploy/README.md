# 📦 部署文档目录

本目录包含树木标签系统的所有部署相关文档和脚本。

---

## 📚 文档列表

### 1. 🚀 **快速开始**
- **文件**: `baota-docker-deploy.md`
- **描述**: 宝塔面板 Docker 部署完整指南
- **适用场景**: 首次部署或需要详细步骤的情况
- **阅读时间**: 10-15 分钟

### 2. ✅ **部署检查清单**
- **文件**: `DEPLOYMENT_CHECKLIST.md`
- **描述**: 完整的部署前后检查清单
- **适用场景**: 确保部署步骤无遗漏
- **阅读时间**: 5 分钟

### 3. ⚙️ **Nginx 配置示例**
- **文件**: `nginx-config-example.conf`
- **描述**: Nginx 反向代理配置文件
- **适用场景**: 配置 Web 服务器
- **使用方式**: 复制并修改域名后使用

---

## 🛠️ 脚本列表

### 1. 🚀 **快速部署脚本**
```bash
./deploy/quick-start.sh
```
- **功能**: 一键构建和启动 Docker 容器
- **使用场景**: 首次部署
- **执行时间**: 5-10 分钟

### 2. 🔄 **更新部署脚本**
```bash
./deploy/update.sh
```
- **功能**: 拉取最新代码并重新部署
- **使用场景**: 代码更新后
- **执行时间**: 3-5 分钟

---

## 📖 快速导航

### 我是新手，第一次部署
1. 阅读 → `baota-docker-deploy.md`
2. 使用 → `DEPLOYMENT_CHECKLIST.md` 检查每一步
3. 执行 → `./deploy/quick-start.sh`
4. 配置 → 按文档配置 Nginx 反向代理

### 我需要更新已部署的系统
1. SSH 登录服务器
2. 执行 → `cd /www/wwwroot/shumu && ./deploy/update.sh`
3. 验证 → 访问网站确认更新成功

### 我遇到了部署问题
1. 查看 → `baota-docker-deploy.md` 的"常见问题"章节
2. 检查 → `DEPLOYMENT_CHECKLIST.md` 的"问题排查"部分
3. 查看日志 → `docker-compose logs -f`

---

## 🎯 部署流程图

```
┌─────────────────────────────────────────────────────────┐
│                    准备服务器环境                          │
│  (安装宝塔面板、Docker、Nginx)                            │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                克隆项目到服务器                            │
│  git clone https://github.com/xuxiang6/shumu.git        │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                   配置环境变量                             │
│  cp .env.example .env && 修改 JWT_SECRET                │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│            执行快速部署脚本                                │
│  ./deploy/quick-start.sh                                │
│  (自动构建镜像、启动容器)                                   │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│           配置 Nginx 反向代理                             │
│  (在宝塔面板或手动配置)                                     │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│      配置 SSL 证书 (可选但推荐)                            │
│  (使用 Let's Encrypt 免费证书)                            │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                验证部署结果                                │
│  访问网站、测试登录、检查 API                               │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
                 ✅ 部署完成！
```

---

## 🔧 常用命令速查

### Docker 容器管理
```bash
# 查看容器状态
docker-compose ps

# 查看实时日志
docker-compose logs -f

# 重启服务
docker-compose restart

# 停止服务
docker-compose down

# 启动服务
docker-compose up -d
```

### 更新和维护
```bash
# 拉取最新代码
git pull origin develop

# 更新部署
./deploy/update.sh

# 查看资源使用
docker stats
```

### 问题排查
```bash
# 检查 API 健康状态
curl http://localhost:5000/health

# 查看 API 日志
docker-compose logs api

# 查看 Web 日志
docker-compose logs web

# 检查端口占用
netstat -tuln | grep -E '80|5000'
```

---

## 🌐 访问地址

部署完成后，系统访问地址：

- **Web 前端**: 
  - HTTP: `http://your-domain.com` 或 `http://服务器IP`
  - HTTPS: `https://your-domain.com` (配置 SSL 后)

- **API 接口**: 
  - `http://your-domain.com/api` (通过 Nginx 代理)
  - ⚠️ 直接访问 5000 端口已被防火墙禁用

- **健康检查**: 
  - `http://your-domain.com/api/health`

---

## ⚙️ 系统架构

```
                     ┌─────────────────┐
                     │   用户浏览器      │
                     └────────┬────────┘
                              │
                     ┌────────▼────────┐
                     │  Nginx (80/443) │
                     │   反向代理        │
                     └────────┬────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
     ┌────────▼────────┐     │      ┌────────▼────────┐
     │  Web Container  │     │      │  API Container  │
     │   (Next.js)     │     │      │   (NestJS)      │
     │   Port: 3000    │     │      │   Port: 5000    │
     └─────────────────┘     │      └────────┬────────┘
                             │               │
                             │      ┌────────▼────────┐
                             │      │  SQLite 数据库   │
                             │      │  (Prisma ORM)   │
                             │      └─────────────────┘
                             │
                    ┌────────▼────────┐
                    │  React Native   │
                    │  移动应用 (APP)  │
                    └─────────────────┘
```

---

## 📞 获取帮助

### 文档问题
- 查看 → 本目录下的各个文档
- 搜索 → 使用 Ctrl+F 在文档中搜索关键词

### 技术问题
1. 查看 Docker 日志: `docker-compose logs -f`
2. 查看 Nginx 日志: `/www/wwwlogs/shumu-error.log`
3. 查看项目 GitHub Issues
4. 联系技术支持

### 更新记录
查看项目的 Git 提交历史:
```bash
git log --oneline
```

---

## ✨ 特别说明

### 数据库选型
- **开发环境**: SQLite (无需额外配置)
- **生产环境**: 可升级到 MySQL/PostgreSQL (修改 `DATABASE_URL`)

### 性能优化
- Docker 镜像使用多阶段构建，优化体积
- Next.js 使用静态资源缓存
- API 使用健康检查确保服务可用性

### 安全措施
- JWT 密钥强制修改
- API 端口不对外暴露
- 支持 HTTPS 加密传输
- 使用 Nginx 反向代理隐藏内部架构

---

**最后更新**: 2025年10月  
**维护者**: 树木标签系统开发团队

