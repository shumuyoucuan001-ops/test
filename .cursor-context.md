# 术木优选标签打印管理系统 - Cursor 开发上下文

## 📋 项目概述
术木优选标签打印管理系统是一个完整的全栈应用，包含Web管理端、移动端应用和后端API服务。

## 🏗️ 项目架构

### 核心技术栈
- **前端Web**: Next.js 15 + TypeScript + Ant Design + Tailwind CSS
- **后端API**: NestJS + TypeScript + Prisma ORM + MySQL
- **移动端**: React Native + Expo
- **部署**: Docker + Docker Compose

### 目录结构
```
📦 shumu/
├── 🌐 web/              # Next.js前端应用 (端口3000)
│   ├── src/app/         # App Router页面
│   ├── src/components/  # React组件
│   ├── src/lib/         # 工具库和API配置
│   └── package.json     # 前端依赖
├── 🔧 server/           # NestJS后端API (端口4000)
│   ├── src/             # 源代码
│   ├── prisma/          # 数据库模型
│   └── package.json     # 后端依赖
├── 📱 SmLabelApp/       # React Native应用
│   ├── src/             # 源代码
│   ├── android/         # Android配置
│   └── ios/             # iOS配置
├── 📱 SmLabelAppExpo/   # Expo应用 (推荐使用)
│   ├── src/             # 源代码
│   ├── src/services/    # 打印服务模块
│   └── assets/          # 静态资源
├── 🚀 deploy/           # 部署配置
├── 🛠️ scripts/          # 工具脚本
└── 📋 PROJECT_STRUCTURE.md # 详细项目文档
```

## 🔧 开发环境

### 启动命令
```bash
# 后端API (必须先启动)
cd server && npm start

# 前端Web
cd web && npm run dev

# 移动端 (推荐Expo版本)
cd SmLabelAppExpo && npx expo start
```

### 访问地址
- **Web前端**: http://localhost:3000
- **后端API**: http://localhost:4000
- **API文档**: http://localhost:4000/api (如果配置了Swagger)

## 🎯 核心功能模块

### 1. 用户权限管理
- **路径**: `web/src/app/home/admin-*`
- **功能**: RBAC权限系统，用户-角色-权限三级管理
- **组件**: `AdminUsers.tsx`, `AdminRoles.tsx`, `AdminPermissions.tsx`

### 2. 标签模板管理
- **路径**: `web/src/app/home/templates`
- **功能**: HTML和TSPL双模板格式支持
- **后端**: `server/src/template/`

### 3. 商品管理
- **路径**: `web/src/app/home/products`
- **功能**: 商品主档管理，标签资料管理
- **后端**: `server/src/product/`, `server/src/label-data/`

### 4. 收货单打印
- **路径**: `web/src/app/home/purchase`
- **功能**: 收货单查询，批量标签打印
- **特性**: 支持HTML预览和TSPL批量打印优化

### 5. 移动端标签打印
- **SmLabelAppExpo**: 功能最完整的Expo应用
- **核心服务**: `src/services/BluetoothPrinter.ts`, `src/services/TsplBuilder.ts`
- **功能**: 蓝牙打印机连接，TSPL指令生成，模板转换

## 📚 重要文件说明

### 配置文件
- `web/next.config.ts` - Next.js配置，包含API代理
- `server/prisma/schema.prisma` - 数据库模型
- `docker-compose.yml` - Docker编排配置

### 核心组件
- `web/src/components/PermissionGuard.tsx` - 权限控制组件
- `web/src/hooks/usePermissions.ts` - 权限管理Hook
- `web/src/lib/api.ts` - API客户端配置

### 数据库表
- `sys_users` - 用户表
- `sys_roles` - 角色表
- `sys_permissions` - 权限表
- `label_templates` - 标签模板表
- `product_master` - 商品主档表
- `label_data` - 标签资料表

## 🔄 开发工作流

### 分支策略
- `main` - 生产环境分支
- `develop` - 开发环境分支 (当前工作分支)
- `feature/*` - 功能开发分支

### 代码规范
- TypeScript严格模式
- ESLint + Prettier格式化
- 组件使用函数式组件 + Hooks
- API使用RESTful设计

## 🚨 注意事项

### 已删除内容
- ❌ `LabelPrintApp/` - 已删除的旧测试版本
- ❌ 各种临时构建文件和缓存

### 端口配置
- 前端开发服务器: 3000
- 后端API服务器: 4000
- Expo开发服务器: 19000 (自动分配)

### 数据库配置
- **主机**: guishumu999666.rwlb.rds.aliyuncs.com:3306
- **用户**: xitongquanju  
- **数据库**: sm_xitongkaifa (主库), sm_chaigou (采购库)
- **配置**: `server/.env` (复制自 `.env.example`)
- **详细说明**: 参考 `DATABASE_SETUP.md`

### 环境变量
- 后端需要配置 `.env` 文件
- 包含数据库连接字符串和JWT密钥

## 🎯 当前开发状态
- ✅ 基础架构完成
- ✅ 用户权限系统完成
- ✅ 标签模板系统完成
- ✅ 移动端应用基础完成
- 🔄 持续优化和新功能开发中

## 💡 开发建议
1. 优先使用SmLabelAppExpo进行移动端开发
2. 新功能开发前先创建feature分支
3. 遵循现有的代码结构和命名规范
4. 及时更新PROJECT_STRUCTURE.md文档

---

## 🤝 多设备协作指南

### 📝 更新此文件的时机
当您添加新功能或修改架构时，请更新相应部分：

1. **新增功能模块** - 更新"核心功能模块"部分
2. **修改数据库** - 更新"数据库表"部分
3. **新增重要文件** - 更新"重要文件说明"部分
4. **改变开发流程** - 更新"开发工作流"部分

### 🔄 协作最佳实践
- **提交时**: 简要说明在commit message中
- **重大变更**: 同时更新DEVELOPMENT.md
- **新增依赖**: 更新相关package.json说明
- **API变更**: 更新接口文档

### 📋 更新模板
```markdown
## [功能名称]
- **路径**: `相对路径`
- **功能**: 功能描述
- **组件/服务**: 相关文件列表
- **特性**: 特殊特性说明
```

### 🏷️ 最后更新
- **时间**: 2024-09-25
- **更新者**: 系统自动配置
- **主要变更**: 初始化多设备开发配置